<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


    <style type="text/css">
        body {max-width:1200px}
        div.container {padding-top:30px;max-width:1000px}
        input {width:100%}
        .divfon {background-color:#223344;padding-top:10px}
        .ots{padding-top:30px}
        .carview{font-size:1.1em}
        .cardel{margin-left:20px}
        .caredit{margin-left:20px}
    </style>

</head>

<body>

<div class="container">


    <form role="form" method="post" action="" name="addform" id="addform">

        <div class="row">
            <div class="col-xs-12 divfon">

                <div class="form-group col-xs-2">
                    <input type="text" required class="form-control" name="number" id="number" placeholder="Номер машины" data-validation-required-message="Пожалуйста укажите номер машины">
                </div>

                <div class="form-group col-xs-4">
                    <input type="text" required class="form-control" name="name" id="name" placeholder="Название машины" data-validation-required-message="Пожалуйста укажите марку машины и двигатель">
                </div>

                <div class="form-group col-xs-3">
                    <input type="number" required class="form-control" name="year" id="year" placeholder="Год выпуска" pattern="[0-9]{4}" data-validation-required-message="Пожалуйста укажите год выпуска, 4 цифры">
                </div>

                <div class="form-group col-xs-3">
                    <input type="number" required class="form-control" name="price" id="price" placeholder="Стоимость" pattern="[0-9]{1,}" data-validation-required-message="Пожалуйста укажите стоимость, только цифры">
                </div>

                <div class="form-group col-xs-offset-9 col-xs-6">
                    <button class="btn btn-default" name="add" id="add">Все верно, отправить</button>
                </div>

                <input type="hidden" name="action" value="add">

                <div class="clearfix"></div>


            </div>
        </div>
    </form>

    <div class="row">
        <div class="col-xs-12 text-center ots">
            <b>ПРОСМОТР АВТОМОБИЛЕЙ</b>
        </div>
    </div>


    <div class="row">
        <div class="col-xs-12 text-center ots" id="info">

        </div>
    </div>

</div>

 <script type="text/javascript">

  $('body').on('click','.caredit', function(){
                event.preventDefault();
                var number = $(this).attr('rel');
                var JSONObject= {
                 "number":number
                 };

                $.ajax({
                    type: "POST",
                    url: "/caredit",
                    data: JSON.stringify(JSONObject),
                    contentType: "application/json",
                    dataType: "json",
                    success: function(data){
                        car_form_make(data);
                    }
                });
                return false;
    });


 $('body').on('click','.cardel', function(){
                event.preventDefault();
                var number = $(this).attr('rel');
                var JSONObject= {
                 "number":number
                 };

                $.ajax({
                    type: "POST",
                    url: "/cardel",
                    data: JSON.stringify(JSONObject),
                    contentType: "application/json",
                    dataType: "json",
                    success: function(data){
                        car_print(data);
                    }
                });
                return false;
    });

 $(document).ready(function(){

      get_cars();

  $('#addform').submit(function(){
        event.preventDefault();
        var name = document.getElementById("name").value;
        var number = document.getElementById("number").value;
        var price = document.getElementById("price").value;
        var year = document.getElementById("year").value;

        var JSONObject= {
             "name":name,
             "number":number,
             "price":price,
             "year":year
             };
        $.ajax({
            url:'/caradd',
            type:'POST',
            data:JSON.stringify(JSONObject),
            contentType: "application/json",
            dataType: "json",
            success: function(data) {
                car_print(data);
                }
        });
        return false;
    });


     function get_cars()
      {
            $.getJSON('/caradmin', function(data) {
            car_print(data);
            });
       }

 });


        function car_print(data) {
         s  = "";
         $.each(data, function(key, val) {
                    s = s + '<span class="carview">' + val['number'] + ' => ' + val['name'] + ' => ' + val['year'] + ' => ' + val['price'] +
                    '</span> <a rel="'+val['number']+'" href="" class="cardel">Удалить</a>' +
                    '<a rel="'+val['number']+'" href="" class="caredit">Редактировать</a><br><br>'
                });
                $("#info").html(s);
       }

        function car_form_make(data) {
                document.getElementById("name").value=data['name'];
                document.getElementById("number").value=data['number'];
                document.getElementById("year").value=data['year'];
                document.getElementById("price").value=data['price'];
       }


 </script>



</body>
</html>